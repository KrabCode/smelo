<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blind Tracker – SMELO.CZ</title>
    <link rel="icon" type="image/x-icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../base.css">
    <link rel="stylesheet" href="style.css">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
</head>
<body>
    <!-- Header -->
    <div class="tracker-header">
        <div class="stat-item">Buy-in: <span id="hd-buyin-amount">400 Kč</span></div>
        <div class="stat-item">Žetony: <span id="hd-chips">0</span></div>
        <div class="stat-item">Prize pool: <span id="hd-pool">0 Kč</span> / <span id="hd-places">0</span> <span id="hd-places-label">výherců</span></div>
        <div class="stat-item">Hráči: <span id="hd-active">0</span> / <span id="hd-buyin">0</span></div>
        <div class="stat-item">Průměrný stack: <span id="hd-avg">0</span></div>
        <div class="zoom-controls">
            <div class="table-tabs" id="table-tabs"></div>
            <button id="btn-toggle-admin" title="Admin režim"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg></button>
            <button id="zoom-out"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/></svg></button>
            <button id="zoom-in"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button>
            <button id="btn-fullscreen" title="Celá obrazovka"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/><line x1="21" y1="3" x2="14" y2="10"/><line x1="3" y1="21" x2="10" y2="14"/></svg></button>
            <button id="btn-test-sound" title="Test zvuku"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></svg></button>
            <button id="btn-toggle-ticker" title="Zobrazit/skrýt ticker"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="3" y1="8" x2="21" y2="8"/><line x1="3" y1="16" x2="15" y2="16"/></svg></button>
            <button id="btn-toggle-seating" title="Zobrazit/skrýt stůl"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="12" cy="12" r="4"/></svg></button>
        </div>
    </div>
    <div class="main-content">
        <!-- Left sidebar: Blind structure -->
        <div class="sidebar sidebar-left">
            <div class="structure-wrap">
                <table class="structure-table">
                    <thead>
                        <tr><th>Level</th><th>Čas</th><th>SB</th><th>BB</th><th id="th-ante" style="display:none">Ante</th></tr>
                    </thead>
                    <tbody id="structure-body"></tbody>
                </table>
            </div>
        </div>

        <!-- Display -->
        <div class="display" id="display">
            <div class="timer" id="timer">00:00</div>
            <div class="progress-wrap"><div class="progress-bar" id="progress-bar"></div></div>
            <div class="blinds-label" id="blinds-label">BLINDY</div>
            <div class="blinds-current" id="blinds-current">– / –</div>
            <div class="blinds-sub" id="blinds-sub"></div>
            <div class="addon-banner" id="addon-banner" style="display:none"></div>
            <div class="break-message" id="break-message" style="display:none"></div>
            <div class="next-level" id="next-level"></div>
        </div>

        <!-- Winner banner (shown when all places declared) -->
        <div class="winner-banner" id="winner-banner" style="display:none">
            <div class="winner-label">VÝSLEDKY TURNAJE</div>
            <div id="winner-list"></div>
        </div>

        <!-- Right sidebar: Payout + player count + seating -->
        <div class="sidebar sidebar-right">
            <div class="payout-section" id="payout-section">
                <table class="payout-table">
                    <thead><tr><th>Místo</th><th>%</th><th>Výhra</th></tr></thead>
                    <tbody id="payout-body"></tbody>
                </table>
            </div>
            <div class="players-remaining" id="players-remaining">
                <span class="players-remaining-label" id="remaining-verb">zbývá</span>
                <span class="players-remaining-count" id="remaining-count">0</span>
                <span class="players-remaining-label" id="remaining-noun">hráčů</span>
            </div>
            <div class="seating-section">
                <div class="seating-table-visual" id="seating-table-visual"></div>
            </div>
        </div>
    </div><!-- .main-content -->

    <!-- Admin panel (only with ?admin) -->
    <div class="admin-panel" id="admin-panel" style="display:none">
        <details>
            <summary>ADMIN OVLÁDÁNÍ</summary>

            <!-- Tournament config (frozen when running) -->
            <div class="admin-section" id="section-config">
                <h3>Nastavení turnaje</h3>
                <div class="config-grid">
                    <div class="config-sub">Struktura</div>
                    <div class="config-field">
                        <label>Délka levelu (min)</label>
                        <input type="number" id="cfg-level-dur" value="20">
                    </div>
                    <div class="config-field">
                        <label>Max levelů</label>
                        <input type="number" id="cfg-max-levels" value="12" min="2">
                    </div>
                    <div class="config-field">
                        <label>Min SB</label>
                        <input type="number" id="cfg-smallest" value="25">
                    </div>
                    <div class="config-field">
                        <label>Max BB</label>
                        <input type="number" id="cfg-max-bb" value="10000" min="100">
                    </div>
                    <div class="config-field">
                        <label>Ante (× BB)</label>
                        <input type="number" id="cfg-ante-mult" value="0" min="0" max="10" step="0.5">
                    </div>
                    <div class="config-field">
                        <label>Orientační začátek</label>
                        <input type="time" id="cfg-start-time-est" value="19:00" step="60">
                    </div>
                    <div class="config-field config-full-row">
                        <label>Křivka blindů: <span id="blind-curve-val">1.0</span></label>
                        <input type="range" id="cfg-blind-curve" min="0.5" max="2.0" step="0.1" value="1.0">
                        <small class="config-hint">0.7 = rychlý start | 1.0 = rovnoměrný růst | 1.3 = rychlý konec</small>
                    </div>
                    <div class="config-sub">Přestávka</div>
                    <div class="config-field">
                        <label>Délka přestávky (min)</label>
                        <input type="number" id="cfg-break-dur" value="30" min="1">
                    </div>
                    <div class="config-field">
                        <label>Přestávka každých N levelů (0 = žádná)</label>
                        <input type="number" id="cfg-levels-per-break" value="0" min="0">
                    </div>
                    <div class="config-sub">Žetony</div>
                    <div class="config-field">
                        <label>Buy-in (Kč)</label>
                        <input type="number" id="cfg-buyin-amount" value="400">
                    </div>
                    <div class="config-field">
                        <label>Počáteční žetony hráče</label>
                        <input type="number" id="cfg-stack" value="5000">
                    </div>
                    <div class="config-field">
                        <label>Bonus žetony za včasný příchod</label>
                        <input type="number" id="cfg-bonus" value="5000">
                    </div>
                    <div class="config-sub">Add-on</div>
                    <div class="config-field">
                        <label>Add-on cena (Kč)</label>
                        <input type="number" id="cfg-addon-amount" value="0" min="0">
                    </div>
                    <div class="config-field">
                        <label>Add-on žetony</label>
                        <input type="number" id="cfg-addon-chips" value="0" min="0">
                    </div>
                </div>
                <div class="save-status" id="config-save-status"></div>
            </div>

            <!-- Player list -->
            <div class="admin-section" id="section-players">
                <h3>Hráči</h3>
                <div class="player-add-row">
                    <input type="text" id="new-player-name" placeholder="Jméno hráče...">
                    <button class="btn" id="btn-add-player">+ Hráč</button>
                    <button class="btn" id="btn-add-test-players">+ Test (8)</button>
                    <button class="btn danger" id="btn-remove-all-players">Smazat vše</button>
                </div>
                <div id="players-list"></div>
                <div id="player-summary" class="player-summary"></div>
            </div>

            <!-- Table locks -->
            <div class="admin-section" id="section-table-locks">
                <h3>Zasedací pořádek</h3>
                <div id="table-locks-ui"></div>
                <div class="btn-row" style="margin-top:12px">
                    <button class="btn" id="btn-reshuffle-seats">Přepočítat</button>
                </div>
                <p class="config-hint" style="margin-top:12px">Když jeden stůl má o 2 hráče méně než jiný, zvažme přemístit nejchudšího hráče z plnějšího stolu k prázdnějšímu — zůstane tak na všech stolech relativně stejně žetonů.</p>
            </div>

            <!-- Payout config -->
            <div class="admin-section" id="section-payout-config">
                <h3>Výplaty</h3>
                <div id="payout-config-rows"></div>
                <div class="btn-row" style="margin-top:8px">
                    <button class="btn" id="btn-payout-add">+ Místo</button>
                    <button class="btn" id="btn-payout-remove">− Místo</button>
                    <button class="btn" id="btn-payout-auto">Auto</button>
                </div>
                <div class="payout-config-total" id="payout-config-total"></div>
            </div>

            <!-- Winners -->
            <div class="admin-section">
                <h3>Výsledky</h3>
                <div id="winners-fields"></div>
                <div class="btn-row" style="margin-top:8px">
                    <button class="btn accent" id="btn-save-winners">Ukončit turnaj</button>
                </div>
            </div>

            <!-- Timer controls -->
            <div class="admin-section">
                <h3>Timer</h3>
                <div class="btn-row">
                    <button class="btn accent" id="btn-start">Start</button>
                    <button class="btn danger" id="btn-reset">Reset</button>
                </div>
                <div id="start-time-row" style="display:none;margin-top:10px">
                    <div class="config-field">
                        <label>Čas startu (posun timeru)</label>
                        <div style="display:flex;gap:6px;align-items:center">
                            <input type="time" id="cfg-start-time" step="60">
                            <button class="btn" id="btn-set-start-time" style="flex:0 0 auto;min-width:auto;padding:8px 12px">Nastavit</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notes (ticker) -->
            <div class="admin-section">
                <h3>Poznámky (ticker)</h3>
                <div id="notes-list"></div>
                <div class="btn-row" style="margin-top:8px">
                    <button class="btn" id="btn-add-note">+ Poznámka</button>
                    <span class="save-status" id="notes-save-status"></span>
                </div>
                <div class="config-field" style="margin-top:12px;border-top:1px solid rgba(255,255,255,0.06);padding-top:12px">
                    <label>Text při přestávce</label>
                    <textarea id="cfg-break-message" rows="6" placeholder="Např. Občerstvení v kuchyni..." style="width:100%"></textarea>
                    <span class="save-status" id="break-save-status"></span>
                </div>
            </div>
        </details>
    </div>

    <div class="tracker-footer" id="tracker-footer"><span class="ticker-track"><span class="ticker-half" id="ticker-a"></span><span class="ticker-half" id="ticker-b"></span></span></div>

    <script src="app.js"></script>
</body>
</html>
